<!DOCTYPE html>
<html class="dark" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Duane Shortt's Extreme Fitness Coach Login</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
      rel="stylesheet"
    />
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#ec1313",
              "background-light": "#f8f6f6",
              "background-dark": "#111111",
            },
            fontFamily: {
              display: ["Lexend", "sans-serif"],
            },
            borderRadius: {
              DEFAULT: "0.25rem",
              lg: "0.5rem",
              xl: "0.75rem",
              full: "9999px",
            },
          },
        },
      };
    </script>
    <style>
      .material-symbols-outlined {
        font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
      }
    </style>
  </head>
  <body class="font-display bg-background-dark">
    <div
      id="auth-loading"
      class="fixed inset-0 z-50 flex items-center justify-center bg-black/90"
    >
      <div class="text-center space-y-3">
        <div
          class="h-10 w-10 animate-spin rounded-full border-2 border-zinc-500 border-t-primary mx-auto"
        ></div>
        <p class="text-zinc-200 text-sm font-medium">
          Checking your session...
        </p>
      </div>
    </div>

    <div
      class="relative flex h-screen min-h-screen w-full flex-col items-center justify-center bg-background-dark group/design-root overflow-x-hidden p-4 sm:p-6 md:p-8"
    >
      <div class="flex w-full max-w-md flex-col items-center justify-center">
        <div
          class="flex w-full flex-col items-center justify-center gap-6 rounded-none border-none bg-transparent p-0 shadow-none"
        >
          <div
            class="flex w-full flex-wrap justify-center gap-3 text-center mb-2"
          >
            <h1
              class="text-zinc-900 dark:text-white tracking-tight text-5xl font-bold leading-tight"
            >
              Duane Shortt's Extreme Fitness
            </h1>
          </div>
          <div class="flex w-full flex-wrap justify-center gap-3 text-center">
            <h2
              class="text-zinc-900 dark:text-white tracking-light text-2xl font-bold leading-tight"
            >
              Coach Login
            </h2>
          </div>
          <div class="flex w-full flex-col gap-4">
            <label class="flex flex-col w-full">
              <p
                class="text-zinc-700 dark:text-white text-base font-medium leading-normal pb-2"
              >
                Email
              </p>
              <input
                id="email-input"
                class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-zinc-900 dark:text-white focus:outline-0 border border-zinc-700 bg-zinc-900 focus:border-primary dark:focus:border-primary h-12 placeholder:text-zinc-500 px-4 py-2 text-base font-normal leading-normal ring-0 focus:ring-2 focus:ring-primary/20"
                placeholder="Enter your email address"
                type="email"
                value=""
              />
            </label>
            <label class="flex flex-col w-full">
              <p
                class="text-zinc-700 dark:text-white text-base font-medium leading-normal pb-2"
              >
                Password
              </p>
              <div class="flex w-full flex-1 items-stretch rounded-lg">
                <input
                  id="password-input"
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-zinc-900 dark:text-white focus:outline-0 border border-zinc-700 bg-zinc-900 focus:border-primary dark:focus:border-primary h-12 placeholder:text-zinc-500 px-4 py-2 rounded-r-none border-right-0 ring-0 focus:ring-2 focus:ring-primary/20"
                  placeholder="Enter your password"
                  type="password"
                  value=""
                />
                <button
                  type="button"
                  id="toggle-password"
                  class="text-zinc-400 dark:text-zinc-500 flex border border-zinc-700 bg-zinc-900 items-center justify-center pr-4 pl-3 rounded-r-lg border-l-0 focus:outline-none"
                >
                  <span class="material-symbols-outlined text-xl">
                    visibility
                  </span>
                </button>
              </div>
            </label>
          </div>
          <div class="flex w-full py-3 justify-center">
            <button
              id="login-button"
              class="flex min-w-[84px] w-full cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-primary text-white text-base font-bold leading-normal tracking-[0.015em] transition-opacity hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-zinc-900"
            >
              <span class="truncate">Login</span>
            </button>
          </div>
          <div class="flex w-full justify-center">
            <a
              id="forgot-password-link"
              class="text-sm font-medium text-primary hover:underline focus:outline-none focus:ring-2 focus:ring-primary/50 rounded-sm"
              href="#"
              >Forgot Password?</a
            >
          </div>
        </div>
      </div>
    </div>

    <script>
      // Initialize Firebase (Compat Version)
      const firebaseConfig = {
        apiKey: "AIzaSyA_D8lToqMx6-9wVei86AVrhtFsoPNRzUA",
        authDomain: "nutritionplangenerator.firebaseapp.com",
        projectId: "nutritionplangenerator",
        storageBucket: "nutritionplangenerator.firebasestorage.app",
        messagingSenderId: "1063853006421",
        appId: "1:1063853006421:web:cb006ba01f538a9ea57edc"
      };

      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();

      // DOM elements
      const emailInput = document.getElementById("email-input");
      const passwordInput = document.getElementById("password-input");
      const loginButton = document.getElementById("login-button");
      const forgotPasswordLink = document.getElementById("forgot-password-link");
      const togglePasswordButton = document.getElementById("toggle-password");
      const togglePasswordIcon = togglePasswordButton?.querySelector(".material-symbols-outlined");
      const authLoadingOverlay = document.getElementById("auth-loading");

      function hideAuthLoading() {
        if (authLoadingOverlay) authLoadingOverlay.classList.add("hidden");
      }

      function setLoading(isLoading) {
        if (!loginButton) return;
        const labelSpan = loginButton.querySelector("span");
        if (isLoading) {
          loginButton.disabled = true;
          if (labelSpan) labelSpan.textContent = "Logging in...";
        } else {
          loginButton.disabled = false;
          if (labelSpan) labelSpan.textContent = "Login";
        }
      }

      function handleLogin() {
        const email = emailInput?.value.trim();
        const password = passwordInput?.value || "";

        if (!email || !password) {
          alert("Please enter both email and password.");
          return;
        }

        setLoading(true);

        // COMPAT Login Method
        auth.signInWithEmailAndPassword(email, password)
          .then((userCredential) => {
            // Success! The onAuthStateChanged below will handle the redirect
            console.log("Login successful");
          })
          .catch((error) => {
            console.error("Login error:", error);
            setLoading(false);
            
            let message = "Login failed.";
            if (error.code === "auth/wrong-password" || error.code === "auth/user-not-found") {
              message = "Incorrect email or password.";
            } else if (error.code === "auth/too-many-requests") {
              message = "Too many failed attempts. Please try again later.";
            }
            alert(message);
          });
      }

      // Event Listeners
      if (loginButton) {
        loginButton.addEventListener("click", (e) => {
          e.preventDefault();
          handleLogin();
        });
      }

      if (passwordInput) {
        passwordInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            handleLogin();
          }
        });
      }

      if (forgotPasswordLink) {
        forgotPasswordLink.addEventListener("click", (e) => {
          e.preventDefault();
          const email = emailInput?.value.trim();
          if (!email) {
            alert('Please enter your email address first.');
            return;
          }
          auth.sendPasswordResetEmail(email)
            .then(() => alert("Password reset email sent."))
            .catch((error) => alert("Error: " + error.message));
        });
      }

      if (togglePasswordButton && passwordInput) {
        togglePasswordButton.addEventListener("click", () => {
          const isPassword = passwordInput.type === "password";
          passwordInput.type = isPassword ? "text" : "password";
          if (togglePasswordIcon) {
            togglePasswordIcon.textContent = isPassword ? "visibility_off" : "visibility";
          }
        });
      }

      // AUTH LISTENER
      // This is the most important part. When this detects a login, it redirects.
      auth.onAuthStateChanged((user) => {
        if (user) {
          // IMPORTANT: Ensure this filename matches your actual file exactly!
          window.location.href = "2coachdashboard.html"; 
        } else {
          hideAuthLoading();
        }
      });
    </script>
  </body>
</html>